$(document).ready(function(){$(".opad").hide(),$(document).on("keyup","input[name=cod],input[name=desc]",keyUpInput),$(document).on("click",".btn-add-supply",addsupply),$(".btn-register-all-list").on("click",register_all_list),$(document).on("change","input[name=nper]",changeperiod),$(".btn-list-period").on("click",register_period_pased),$(".stkmin").on("change",chkmin),$("button[name=btn-opad]").click(function(e){$(".opad").toggle("blind",600)}),$(".btn-stmp-supply").on("click",save_tmp_supply),$("#bdelAllInv").on("click",bdelallitem),$("#bupall").on("click",function(){$("#ufile").modal("show")}),$(".upfile").on("click",uploadFile)});var bdelallitem=function(e){swal({title:"Eliminar todo el inventario?",text:"realmente desea eliminar todo el inventario?",type:"warning",showCancelButton:!0,confirmButtonText:"Si!",confirmButtonColor:"#DD6B55",cancelButtonText:"No"},function(a){console.log(e),a&&(e.currentTarget.disabled=!0,e.currentTarget.innerHTML='<i class="fa fa-spinner fa-pulse"></i> Procesando',data={delInventory:!0,csrfmiddlewaretoken:$("[name=csrfmiddlewaretoken]").val()},$.post("",data,function(a){a.status?location.reload():(e.currentTarget.disabled=!1,e.currentTarget.innerHTML='<i class="fa fa-fire"></i> Eliminar Todo')},"json"))})},uploadFile=function(e){e.currentTarget.disabled=!0,e.currentTarget.innerHTML='<i class="fa fa-spinner fa-pulse"></i> Procesando',data=new FormData,data.append("csrfmiddlewaretoken",$("[name=csrfmiddlewaretoken]").val()),data.append("uploadInventory",!0),data.append("inventory",$("#afile")[0].files[0]),$.ajax({url:"",data:data,dataType:"json",type:"post",processData:!1,contentType:!1,cache:!1,success:function(a){a.status?location.reload():(e.currentTarget.disabled=!1,e.currentTarget.innerHTML='<i class="fa fa-upload"></i> Cargar')}})},save_tmp_supply=function(e){e.preventDefault();var a=new Object,t=!1;$(".add-id, .add-cant").each(function(){return""==this.value?($().toastmessage("showWarningToast","Se a encontrado un campo vacio."),this.focus(),!1):(a[this.name]=this.value,void(t=!0))}),t&&(a.tipo="save-tmp",a.csrfmiddlewaretoken=$("input[name=csrfmiddlewaretoken]").val(),a["add-ori"]="AL",a["add-oid"]=$("select[name=almacen]").val(),console.info(a),$.post("",a,function(e){e.status?($("button[name=btn-"+a["add-id"]+"]").attr("disabled",!0),$().toastmessage("showNoticeToast","Se agrego a Temp Suministro, correctamente."),$(".add-id").val(""),$(".maddsupply").modal("hide")):$().toastmessage("showErrorToast","He fallado! en mi misi√≥n.")},"json"))},addsupply=function(e){e.preventDefault(),$(".add-id").val(this.value),$(".maddsupply").modal("show")},changeperiod=function(e){e.preventDefault(),$("select[name=periodo]").attr("disabled","now"==this.value)},chkmin=function(e){e.preventDefault(),$("[name=smin]").attr("disabled",!this.checked)},keyUpInput=function(e){e.preventDefault();var a=e.keyCode?e.keyCode:e.which;13==a&&search(this,1)},search=function(e,a){var t=new Object;t.periodo=$("select[name=periodo]").val(),t.almacen=$("select[name=almacen]").val(),t.omat=e.value,t.tipo=e.name,t.stkzero=$(".stkzero").is(":checked")?1:0,t.stkmin=$(".stkmin").is(":checked")?$("[name=smin]").val():"None",t.page=a,$.get("",t,function(a){var t=$("tbody"),n="<tr class='{{status}}'><td>{{item}}</td><td><a href='brand/{{materiales_id}}/'>{{materiales_id}}</a></td><td>{{matnom}} - {{matmed}}</td><td>{{unid}}</td><td>{{stkmin}}</td><td>{{stock}}</td><td>{{ingreso}}</td><td>{{compra_id}}</td><td><button value='{{ materiales_id }}' class='btn btn-xs btn-warning btn-add-supply text-black' {{ dis }}><span class='glyphicon glyphicon-plus'></span><span class='glyphicon glyphicon-shopping-cart'></span></button></td></tr>";t.empty();for(var i in a.list)a.list[i].status=a.list[i].stock<=0?"danger":a.list[i].stock>=a.list[i].stkmin?"success":"warning",a.list[i].item=parseInt(i)+1,a.list[i].dis=a.list[i].spptag?"disabled":"",t.append(Mustache.render(n,a.list[i]));var s="";a.has_previous&&(s+="<li><a href=javascript:search_page('"+e.name+"',1);>&laquo;</a><li><li><a href=javascript:search_page('"+e.name+"',"+a.previous_page_number+");>Anterior</a></li>"),s+=" <li> Page "+a.number+" of "+a.num_pages+" <li> ",a.has_next&&(s+="<li><a href=javascript:search_page('"+e.name+"',"+a.next_page_number+");>Siguiente</a></li><li><a href=javascript:search_page('"+e.name+"',"+a.num_pages+");>&raquo;</a><li>");var o=$(".pager");o.empty(),o.append(s)})},search_page=function(e,a){console.log(e),console.info($("[name="+e+"]").get(0));var t=$("[name="+e+"]").get(0);console.warn(t),search(t,a)},register_all_list=function(){var e=new Object;e.alid=$("select[name=almacen]").val(),e.quantity=parseInt($("input[name=ias]").val()),e.csrfmiddlewaretoken=$("input[name=csrfmiddlewaretoken]").val(),e.tipo="all",$.post("",e,function(e){console.info(e),e.status&&location.reload()},"json")},register_period_pased=function(){var e=new Object;e.alcp=$("select[name=alcp]").val(),e.pewh=$("select[name=pewh]").val(),e.alwh=$("select[name=alwh]").val(),e.csrfmiddlewaretoken=$("input[name=csrfmiddlewaretoken]").val(),e.tipo="per",console.log(e),$.post("",e,function(e){console.log(e),location.reload()},"json")};