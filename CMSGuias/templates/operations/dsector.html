{% extends "basemd.html" %}
{% block title %}
  Área Sector
{% endblock title %}
{% block menu %}
    {% if user.get_profile.empdni.charge.area|lower == 'ventas' or user.get_profile.empdni.charge.area|lower == 'administrator' %}
        {% include "menus/salesmd.html" %}
    {% endif %}
    {% if user.get_profile.empdni.charge.area|lower == 'logistica' %}
        {% include "menus/logisticsmd.htm" %}
    {% endif %}
    {% if user.get_profile.empdni.charge.area|lower == 'operaciones' %}
        {% include "menus/operationsmd.htm" %}
    {% endif %}
    {% if user.get_profile.empdni.charge.area|lower == 'almacen' %}
        {% include "menus/storagemd.htm" %}
    {% endif %}
{% endblock menu %}
{% block content %}
<link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}css/getMaterials.css">
<link rel="stylesheet" href="{{ MEDIA_URL }}vendor/trumbowyg/dist/ui/trumbowyg.min.css">
<div ng-app="dsApp" ng-controller="DSCtrl">
    <input type="hidden" id="perarea" ng-model="perarea" ng-init="{{ request.user.get_profile.empdni.charge.area|lower }}" value="{{ request.user.get_profile.empdni.charge.area|lower }}">
    <input type="hidden" id="percharge" ng-model="percharge" ng-init="{{ request.user.get_profile.empdni.charge.cargos|lower }}" value="{{ request.user.get_profile.empdni.charge.cargos|lower }}">
    <input type="hidden" id="perdni" ng-model="perdni" ng-init="perdni={{ request.user.get_profile.empdni_id|lower }}" value="{{ request.user.get_profile.empdni_id|lower }}">
    <div class="card-panel" style="background: {{ dsector.sgroup.colour }};">
        <div class="card-content">
            <a  href="{% url 'sectorgroup_view' dsector.sgroup.project_id dsector.sgroup.subproject_id dsector.sgroup.sector_id %}" class="btn grey lighten-5 grey-text text-darken-3"><i class="fa fa-chevron-left"></i> REGRESAR</a>
            <h4>
                ÁREA {{ dsector.name }} {{ dsector.dsector_id }}
                <br>
                <small>
                    GRUPO {{ dsector.sgroup.name }} {{ dsector.sgroup_id }}
                </small>
            </h4>
            <div class="card-content">
                <h5>
                    <small><strong>Tiempo Estimado:</strong> {{ dsector.datestart }} <strong>al </strong> {{ dsector.dateend }}</small>
                    <small>
                        <p>
                        <strong>Descripción: </strong>
                            {{ dsector.description }}
                        </p>
                    </small>
                </h5>
                {% if dsector.plane %}
                    <iframe class="materialboxed" src="{{ MEDIA_URL }}{{dsector.plane}}#zoom=0&toolbar=1&navpanes=0" type="application/pdf">
                        <i class="fa fa-zoom"></i>
                    </iframe>
                {% endif %}
            </div>
            <div class="card-action">
                <div class="center-align">
                    <span class="label-progress">%</span>
                    <div class="progress light-blue accent-2">
                        <div class="determinate light-blue accent-4 percent-progress"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% verbatim %}
    <div class="card-panel">
        <div class="card-content">
            <h4><small>Detalle de Plano</small></h4>
            <div class="row">
                <div class="card col l3 m6 s12" ng-repeat="f in lplanes">
                    <iframe ng-src="{{validUrl(f.fields.files)}}" type="application/pdf" style="width: 100%; height: 100%;"></iframe>
                    <div class="card-action">
                        <button type="button" class="waves-effect waves-teal btn red darken-1 grey-text text-lighten-5" ng-show="perarea == 'administrator' || perarea == 'ventas'" ng-click="delPlane(f.pk)">
                            <i class="fa fa-trash fa-lg"></i>
                        </button>
                        <button type="button" class="btn light-green lighten-1 grey-text text-darken-3 right" ng-click="showFull(f.fields.files)">
                            <i class="fa fa-expand"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endverbatim %}
    {% if user.get_profile.empdni.charge.area|lower == 'ventas' or user.get_profile.empdni.charge.area|lower == 'administrator' %}
    <div class="card">
        <div class="card-content">
            <div class="row">
                <div class="col l6">
                    <h5 class="center-align">Compras</h5>
                    <h5 class="center-align">{{ amount.apurchase|floatformat:2 }}</h5>
                </div>
                <div class="col l6">
                    <h5 class="center-align">Ventas</h5>
                    <h5 class="center-align">{{ amount.asales|floatformat:2 }}</h5>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    <div class="card" id="card">
        <div class="card-action">
            {% if dsector.status == 'PE' %}
                <button type="button" class="btn amber accent-2 grey-text text-darken-3 waves-effect" ng-click="gui.smat=!gui.smat" ng-show="perarea == 'administrator' || perarea == 'ventas' || perdni == '46377134'">
                    <i class="fa fa-plus"></i>
                    <span class="hide-on-med-and-down">Agregar</span>
                </button>
                <button type="button" class="btn waves waves-effect amber accent-2 grey-text text-darken-3 modal" ng-show="perarea == 'administrator' || perarea == 'ventas' || perdni == '46377134'" data-target="mdplane">
                    <i class="fa fa-file-pdf-o"></i>
                    <span class="hide-on-med-and-down">Plano Detalle</span>
                </button>
                {% if modify|length <= 0 %}
                    <button type="button" class="btn amber accent-2 grey-text text-darken-3 waves-effects modal" data-target="mpcopy">
                        <i class="fa fa-clone"></i>
                        <span class="hide-on-med-and-down">Copiar Lista</span>
                    </button>
                    <button type="button" class="btn amber accent-2 grey-text text-darken-3 waves-effect" ng-click="delAreaMA()">
                        <i class="fa fa-trash"></i>
                        <span class="hide-on-med-and-down">Eliminar Todo</span>
                    </button>
                    <button type="button" class="btn amber accent-2 grey-text text-darken-3 waves-effect modal" data-target="mfileup">
                        <i class="fa fa-file-excel-o"></i>
                        <span class="hide-on-med-and-down">Cargar Archivo</span>
                    </button>
                    <button type="button" class="btn amber accent-2 grey-text text-darken-3 waves-effect" ng-click="getListAreaMaterials()">
                        <i class="fa fa-refresh"></i>
                        <span class="hide-on-med-and-down">REcargar</span>
                    </button>
                {% endif %}
            {% endif %}
            {% if dsector.status == 'AC' %}
                <button type="button" class="btn amber accent-2 grey-text text-darken-3 waves-effect" ng-model="btnmodify" ng-init="btnmodify={% if modify|length > 0 %} true {% else %} false {% endif %}" ng-click="showModify()" ng-disabled="btnmodify" ng-show="perarea == 'administrator' || perarea == 'ventas' || perdni == '46377134' || percharge == 'jefe de almacen' || perarea == 'operaciones'">
                    <i class="fa fa-pencil"></i>
                    <span class="hide-on-med-and-down"> Modificar Área</span>
                </button>
                {% if modify|length == 0 %}
                <button type="button" class="btn blue lighten-1" ng-click="pOrders($event)" ng-if="perarea == 'administrator' || perarea == 'ventas' || perarea == 'operaciones' || percharge == 'jefe de almacen'">
                    <i class="fa fa-list"></i>
                    PEDIDO ALMACÉN
                </button>
                {% comment %}<button type="button" ng-click="run()">
                    <i class="fa fa-terminal"></i>
                </button>{% endcomment %}
                {% endif %}
            {% endif %}
            {% if modify|length > 0 %}
                <button type="button" class="btn amber accent-2 grey-text text-darken-3 waves-effect" ng-click="gui.smat=!gui.smat" ng-show="perarea == 'administrator' || perarea == 'ventas' || perdni == '46377134' || percharge == 'jefe de almacen' || perarea == 'operaciones'">
                    <i class="fa fa-plus"></i>
                    <span class="hide-on-med-and-down">Agregar</span>
                </button>
                <button type="button" class="btn red lighten-1 grey-text text-darken-3 waves-effect" ng-click="delAllModifyArea($event)" ng-show="perarea == 'administrator' || perarea == 'ventas' || perdni == '46377134' || percharge == 'jefe de almacen' || perarea == 'operaciones'">
                    <i class="fa fa-fire"></i>
                    <i class="fa fa-trash"></i>
                    <span class="hide-on-med-and-down"> Eliminar Modificación</span>
                </button>
                <button type="button" class="btn green lighten-1 grey-text text-darken-3 waves-effect" ng-click="approvedModify($event)" ng-disabled="!mdstatus && perarea != 'administrator'" ng-show="perarea == 'administrator' || perarea == 'ventas'">
                    <i class="fa fa-pencil"></i>
                    <i class="fa fa-check-square-o"></i>
                    <span class="hide-on-med-and-down"> Aprobar Modificación</span>
                </button>
                <input type="hidden" id="modify" value="true">
            {% endif %}
        </div>
        <div class="card-content" ng-model="gui.pac" ng-init="gui.pac=false" ng-show="gui.pac"></div>
        <div class="card-content" ng-model="gui.smat" ng-init="gui.smat=false" ng-show="gui.smat">
            <div class="row">
                <div class="col l12">
                    <div class="col l6 m6 s12 input-field">
                        <input type="text" name="description">
                        <label>Descripción</label>
                        <ul id="matname-global" class="matname-global"></ul>
                    </div>
                    <div class="col l6 m6 s12 input-field">
                        <label ng-class="{'active': mat.measure != ''}">Medida</label>
                        <select name="meter" class="browser-default" ng-model="mat.measure">
                            <option value="" disabled selected></option>
                        </select>
                    </div>
                </div>
                <div class="col l6 m6 s12">
                    <div class="col l6 m6 s12 input-field">
                        <input type="text" maxlength="15" name="code" ng-model="mat.code">
                        <label ng-class="{'active': mat.code}">Código</label>
                    </div>
                    <div class="input-field col l6 m6 s12">
                        <input ng-value="" type="number" min="0" id="cantidad" name="cantidad" ng-model="mat.quantity" ng-init="mat.quantity=0" class="validate">
                        <label class="active" for="cantidad">Cantidad / Metrado</label>
                    </div>
                    {% verbatim %}
                        <div class="input-field col l6 m6 s12">
                            <input type="text" ng-model="mat.ppurchase" ng-pattern="[0-9]+([\.][0-9]+)?" min="0" id="precio" name="precio" class="validate" list="lstpurchase">
                            <datalist id="lstpurchase"></datalist>
                            <label class="active" for="precio">Precio Compra</label>
                        </div>
                        <div class="input-field col l6 m6 s12">
                            <input type="text" ng-model="mat.psales" ng-pattern="[0-9]+(\.[0-9]{1,3})?" min="0" id="sales" name="sales" list="lstsales" class="validate">
                            <datalist id="lstsales"></datalist>
                            <label class="active" for="sales">Precio Venta</label>
                        </div>
                        <div class="col l6 m6 s12 input-field">
                            <label class="active">Marca</label>
                            <select class="browser-default" name="brand"></select>
                        </div>
                        <div class="col l6 m6 s12 input-field">
                            <label class="active">Modelo</label>
                            <select class="browser-default" name="model"></select>
                        </div>
                    {% endverbatim %}
                    <div class="col l12 m12 s12 right-align">
                        <br>
                        <span class="left-align">
                            El precio del proyecto esta expresado en {{ dsector.sgroup.project.currency.moneda }}
                        </span>
                        <button type="button" class="btn light-blue darken-2" ng-click="saveMateial()">
                            <i class="fa fa-floppy-o"></i>
                            <span class="hide-on-med-and-down">GUARDAR</span>
                        </button>
                    </div>
                    {# <div class="col l6 m6 s6"></div> #}
                </div>
                <div class="col l6 m6 s12">
                    <table class="table responsive-table tb-details">
                        <caption><strong>Resumén</strong></caption>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        {% if modify|length == 0 %}
            <div class="col l12">
                {% verbatim %}
                    <script type="text/ng-template" id="areatmp.html">
                        <td class="center-align">{{$index + 1}}</td>
                        <td class="center-align">
                            <input type="checkbox" name="chkorders" id="chk{{x.fields.materials.pk}}" value="{{x.fields.materials.pk}}" data-brand="{{x.fields.brand.fields.brand}}" data-brandid="{{x.fields.brand.pk}}" data-modelid="{{x.fields.model.pk}}" data-model="{{x.fields.model.fields.model}}" data-quantity="{{x.fields.qorder}}" data-nme="{{x.fields.materials.fields.matnom}} - {{x.fields.materials.fields.matmed}}" data-nipple="{{x.fields.nipple}}" ng-if="x.fields.tag != '2'"
                            ng-model="preorders[$index].status" class="filled-in blue">
                            <label for="chk{{x.fields.materials.pk}}"></label>
                            <!-- set object materiales for preorders -->
                            <input type="hidden" ng-model="preorders[$index].materials" ng-init="preorders[$index].materials=x.fields.materials">
                            <!-- set object brand for preorders -->
                            <input type="hidden" ng-model="preorders[$index].brand" ng-init="preorders[$index].brand=x.fields.brand">
                            <!-- set object model for preorders -->
                            <input type="hidden" ng-model="preorders[$index].model" ng-init="preorders[$index].model=x.fields.model">
                            <!-- set object niple for preorders -->
                            <input type="hidden" ng-model="preorders[$index].niple" ng-init="preorders[$index].niple=x.fields.nipple">
                            <!-- set object quantity for attend for preorders -->
                            <input type="hidden" ng-model="preorders[$index].quantity" ng-init="preorders[$index].quantity=x.fields.qorder">
                            <!-- set object tag visible for preorders -->
                            <input type="hidden" ng-model="preorders[$index].tag" ng-init="preorders[$index].tag=x.fields.tag">
                            <!-- set index for operations-->
                            <input type="hidden" ng-model="preorders[$index].index" ng-init="preorders[$index].index=$index">
                        </td>
                        <td class="center-align text-9">{{x.fields.materials.pk}}</td>
                        <td>{{x.fields.materials.fields.matnom}} {{x.fields.materials.fields.matmed}}</td>
                        <td class="center-align">{{x.fields.brand.fields.brand}}</td>
                        <td class="center-align">{{x.fields.model.fields.model}}</td>
                        <td class="center-align">{{x.fields.materials.fields.unidad}}</td>
                        <td class="right-align">{{x.fields.quantity}}</td>
                        <td class="right-align">{{x.fields.qorder}}</td>
                        <td class="right-align">{{x.fields.qguide}}</td>
                        <td class="right-align" ng-if="perarea == 'administrator' || perarea == 'ventas'">{{x.fields.ppurchase}}</td>
                        <td class="right-align" ng-if="perarea == 'administrator' || perarea == 'ventas'">{{x.fields.psales}}</td>
                        <td class="right-align" ng-if="perarea == 'administrator' || perarea == 'ventas'">{{x.fields.quantity * x.fields.ppurchase | number:2}}</td>
                        <td class="center-align" ng-if="x.fields.tag == '2'"><i class='fa fa-check'></i></td>
                        <td class="center-align" ng-if="x.fields.tag != '2'"><i class='fa fa-minus'></i></td>
                        <td class="center-align">
                            <a href="#" class="dropdown-button btn waves-effect waves-light grey lighten-5 grey-text text-darken-3" data-constrainwidth="200" data-activates="ba{{x.fields.materials.pk}}{{x.fields.brand.pk}}{{x.fields.model.pk}}">
                              <i class="fa fa-cog"></i>
                            </a>
                            <ul id="ba{{x.fields.materials.pk}}{{x.fields.brand.pk}}{{x.fields.model.pk}}" class="dropdown-content">
                              <li ng-hide="x.fields.dsector.fields.status == 'AC'"><a href="#!" style="padding: 2px 0px 2px 3px;" ng-click="editDMaterial($event)" data-materials="{{x.fields.materials.pk}}" data-quantity="{{x.fields.quantity}}" data-brand="{{x.fields.brand.pk}}" data-model="{{x.fields.model.pk}}" class="waves-effect waves-light light-blue-text text-darken-3"><small><i class="fa fa-edit"></i> Editar</small></a></li>
                              <li class="divider"></li>
                              <li ng-hide="x.fields.dsector.fields.status == 'AC'"><a href="#!" style="padding: 2px 0px 2px 3px;" class="waves-effect waves-light red-text text-darken-1" data-materials="{{x.fields.materials.pk}}" data-brand="{{x.fields.brand.pk}}" data-model="{{x.fields.model.pk}}" ng-click="deleteDMaterial($event)"><small><i class="fa fa-trash"></i> Eliminar</small></a></li>
                              <li class="divider"></li>
                              <li><a href="#!" style="padding: 2px 0px 2px 3px;" ng-click="showCommentMat()" class="waves-effect waves-light grey-text text-darken-3"><small><i class="fa fa-i-cursor"></i> Observación</small></a></li>
                              <li class="divider"></li>
                              <li><a href="#!" style="padding: 2px 0px 2px 3px;" ng-click="availableNipple()" class="waves-effect waves-light grey-text text-darken-3"><small><i class="fa fa-pause fa-rotate-90"></i> Niple</small></a></li>
                            </ul>
                        </td>
                    </script>
                {% endverbatim %}
                <p>
                    <p>
                      <strong>Seleccionar: </strong>
                      <input name="sltorder" type="radio" ng-click="changeSelOrder($event)" id="all" class="with-gap blue" value="1"/>
                      <label for="all">Todo</label>
                      <input name="sltorder" type="radio" ng-click="changeSelOrder($event)" id="nothing" class="with-gap blue" value="0"/>
                      <label for="nothing">Ninguno</label>
                    </p>
                </p>
                <table class="table responsive-table highlight hovered floatThead table-withoutApproved">
                    <caption ng-show="fmatwoa">
                        <div class="input-field">
                            <i class="prefix fa fa-filter"></i>
                            <input type="text" ng-model="finmwoa">
                            <label class="active left-align">Filtrar Material</label>
                        </div>
                    </caption>
                    <thead class="amber lighten-4">
                        {% verbatim %}
                            <tr>
                                <th class="center-align">
                                    <i class="fa fa-angle-double-up cursor-hand" onClick="$('html,body').animate({scrollTop:500},400);"></i>
                                </th>
                                <th></th>
                                <th class="center-align">Código</th>
                                <th>Descripción</th>
                                <th class="center-align">Marca</th>
                                <th class="center-align">Modelo</th>
                                <th class="center-align">Unidad</th>
                                <th class="right-align">Vendido</th>
                                <th class="right-align">Pendiente</th>
                                <th class="right-align">Enviada</th>
                                <th class="right-align" ng-if="perarea == 'administrator' || perarea == 'ventas'">Compra</th>
                                <th class="right-align" ng-if="perarea == 'administrator' || perarea == 'ventas'">Venta</th>
                                <th ng-if="perarea == 'administrator' || perarea == 'ventas'">Importe C</th>
                                <th></th>
                                <th class="center-align"><i class="fa fa-search cursor-hand" ng-model="fmatwoa" ng-click="fmatwoa=!fmatwoa"></i></th>
                            </tr>
                        {% endverbatim %}
                    </thead>
                    <tbody>
                    {% verbatim %}
                        <tr ng-include src="'areatmp.html'" ng-repeat="x in dsmaterials | filter: finmwoa" class="text-12"></tr>
                    {% endverbatim %}
                    </tbody>
                </table>
                <!-- modal comment u observation -->
                <div class="row">
                    <div class="modal col l4 offset-l4" id="mcomment">
                        <div class="modal-content">
                            <div class="input-field">
                                <textarea class="materialize-textarea"></textarea>
                                <label for="textarea1">Observación</label>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="buttom" class="modal-action modal-close btn left grey lighten-5 grey-text text-darken-3">
                                <i class="fa fa-times"></i> Cerrar
                            </button>
                            <button type="buttom"  class="btn green lighten-1 grey-text text-darken-3">
                                <i class="fa fa-i-cursor"></i>
                                GUARDAR
                            </button>
                        </div>
                    </div>
                </div>
                <h4 ng-show="snipple">Niple</h4>
                <ul class="collapsible popout" data-collapsible="accordion">
                {% verbatim %}
                    <li ng-repeat="x in dsmaterials" ng-if="x.fields.nipple == true">
                        <div class="collapsible-header" ng-click="listNipple()">
                            <i class="fa fa-pause fa-rotate-90"></i> {{x.fields.materials.fields.matnom}} {{x.fields.materials.fields.matmed}}
                            <div class="chip right yellow accent-1">
                                Total <span class="to{{x.fields.materials.pk}}">{{x.fields.quantity}}</span> {{x.fields.materials.fields.unidad}}
                            </div>
                            <div class="chip right yellow accent-1">
                                Ingresado
                                <span class="co{{x.fields.materials.pk}}"></span> cm
                            </div>
                            <div class="chip right yellow accent-1">
                                Disponible
                                <span class="dis{{x.fields.materials.pk}}"></span> cm
                            </div>
                        </div>
                        <div class="collapsible-body">
                            <div class="card">
                                <div class="card-actiona">
                                    <div class="row">
                                        <div class="col l2">
                                            <br>
                                            <button type="button" class="btn waves-effect grey lighten-5 grey-text text-darken-3 sdnip{{x.fields.materials.pk}}" ng-model="sdnip[x.fields.materials.pk]" ng-init="sdnip[x.fields.materials.pk]=false;" ng-click="sdnip[x.fields.materials.pk]=!sdnip[x.fields.materials.pk]" ng-if="perarea == 'administrator' || perarea == 'ventas' || perarea == 'operaciones' || percharge == 'jefe de almacen'">
                                                <i class="fa fa-plus"></i>
                                            </button>
                                            <button type="button" class="btn waves-effect grey lighten-5 grey-text text-darken-3 rf{{x.fields.materials.pk}}" ng-click="listNipple()" data-materials="{{x.fields.materials.pk}}">
                                                <i class="fa fa-refresh"></i>
                                            </button>
                                        </div>
                                        <div class="col l2 input-field" ng-show="sdnip[x.fields.materials.pk]">
                                            <input type="number" class="right-align" id="nipple{{x.fields.materials.pk}}measure" ng-model="nipple[x.fields.materials.pk].measure">
                                            <label class="active">Medida cm</label>
                                            <input type="hidden" id="nipple{{x.fields.materials.pk}}edit">
                                        </div>
                                        <div class="col l2 input-field" ng-show="sdnip[x.fields.materials.pk]">
                                            <label class="active">Tipo</label>
                                            <select class="browser-default t{{x.fields.materials.pk}}" id="nipple{{x.fields.materials.pk}}type"></select>
                                        </div>
                                        <div class="col l2 input-field" ng-show="sdnip[x.fields.materials.pk]">
                                            <input type="number" class="right-align" id="nipple{{x.fields.materials.pk}}quantity">
                                            <label class="active">Cantidad</label>
                                        </div>
                                        <div class="col l3 input-field" ng-show="sdnip[x.fields.materials.pk]">
                                            <input type="text" id="nipple{{x.fields.materials.pk}}observation">
                                            <label class="active">Observación</label>
                                        </div>
                                        <div class="col l1" ng-show="sdnip[x.fields.materials.pk]">
                                            <br>
                                            <button type="button" class="btn waves-effect light-blue darken-1" ng-click="saveNipple()">
                                                <i class="fa fa-plus"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <table class="table responsive-table">
                                <thead>
                                    <tr>
                                        <th class="center-align"></th>
                                        <th class="center-align">Cantidad</th>
                                        <th class="center-align">C. Pendiente</th>
                                        <th class="center-align">Tipo</th>
                                        <th class="center-align">Descripción</th>
                                        <th class="center-align">Diametro</th>
                                        <th class="center-align"></th>
                                        <th class="center-align">Medida</th>
                                        <th class="center-align">Observación</th>
                                        <th class="center-align"></th>
                                    </tr>
                                </thead>
                                <tbody class="nip{{x.fields.materials.pk}}"></tbody>
                            </table>
                        </div>
                    </li>
                {% endverbatim %}
                </ul>
            </div>
        {% else %}
            <div class="col l12 m12 s12">
                <h5>
                    Estamos modificando esta área
                    <br>
                    <small>Tienes modificaciones pendientes.</small>
                </h5>
                <div class="row">
                    <div class="col l12 m12 s12">
                        <ul class="tabs idenred">
                            <li class="tab col s3"><a class="grey-text text-darken-3" href="#vmodify"><i class="fa fa-pencil"></i> <strong>MODIFICACION</strong></a></li>
                            <li class="tab col s3"><a class="grey-text text-darken-3 active" href="#vlist"><i class="fa fa-list-alt"></i> <strong>LISTA ACTUAL</strong></a></li>
                            <li class="tab col s3"><a class="grey-text text-darken-3" href="#vprices"><i class="fa fa-dollar"></i> <strong>PRECIOS</strong></a></li>
                        </ul>
                    </div>
                </div>
                {# calculate total #}
            </div>
            <!-- tables modify accesories -->
            <div id="vmodify" class="col l12 m12">
                <div class="card">
                    <div class="card-action right-align">
                        <button class="waves-effect waves-light btn grey lighten-5 grey-text text-darken-3" type="button" ng-model="mmview" ng-init="mmview=true" ng-click="mmview=!mmview">
                            <i class="fa" ng-class="{'fa-eye': mmview, 'fa-eye-slash': !mmview}"></i>
                        </button>
                    </div>
                </div>
                {% verbatim %}
                <ul class="collapsible popout" data-collapsible="expandable">
                    <li ng-class="{'active': mmview}">
                        <div ng-class="{'active': mmview}" class="collapsible-header green-text text-lighten-1">
                            <i class="fa fa-plus"></i> Nuevos
                            <div style="margin-top: 5px;" class="chip right green lighten-2">
                                <strong>Venta: {{tmlstN[1] | number:"2"}}</strong></div>
                            <div style="margin-top: 5px;" class="chip right green lighten-2">
                                <strong>Compra: {{tmlstN[0] | number:"2"}}</strong></div>
                        </div>
                        <div class="collapsible-body" ng-style="mmview ? {display: 'block'} : {display: 'none'}">
                            <table class="table responsive-table highlight hovered">
                                <thead>
                                    <tr class="green lighten-5">
                                        <th class="col-1">
                                            <a href="#!" class="grey-text text-darken-3">
                                                <i class="fa fa-filter"></i></a>
                                        </th>
                                        <th class="col-3">Código</th>
                                        <th>
                                            Descripción
                                        </th>
                                        <th class="col-2">Marca</th>
                                        <th class="col-2">Modelo</th>
                                        <th class="col-1">Unidad</th>
                                        <th class="col-2">P. Compra</th>
                                        <th class="col-2">P. Venta</th>
                                        <th class="col-2">Cantidad</th>
                                        <th class="col-1">
                                            <a href="#!lnew" class="blue-text" ng-click="listTemps('N')">
                                                <i class="fa fa-refresh"></i>
                                            </a>
                                        </th>
                                        <th class="col-1">
                                            <a href="#!del" class="red-text" ng-click="delModifiedNMD('N')">
                                                <i class="fa fa-trash"></i>
                                            </a>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="x in lstN">
                                        <td>{{$index+1}}</td>
                                        <td>{{x.fields.materials.pk}}</td>
                                        <td>{{x.fields.materials.fields.matnom}} {{x.fields.materials.fields.matmed}}</td>
                                        <td class="center-align">{{x.fields.brand.fields.brand}}</td>
                                        <td class="center-align">{{x.fields.model.fields.model}}</td>
                                        <td>{{x.fields.materials.fields.unidad}}</td>
                                        <td class="right-align">{{x.fields.ppurchase}}</td>
                                        <td class="right-align">{{x.fields.psales}}</td>
                                        <td class="right-align">{{x.fields.quantity}}</td>
                                        <td class="center-align"><i class="fa fa-long-arrow-up"></i></td>
                                        <td class="center-align">
                                            <input type="checkbox" class="filled-in red" id="filled-in-boxlstn{{$index}}" ng-model="lstN[$index].selected" ng-init="lstN[$index].selected=false" />
                                            <label for="filled-in-boxlstn{{$index}}"></label>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </li>
                    <li ng-class="{'active': mmview}">
                        <div ng-class="{'active': mmview}" class="collapsible-header blue-text text-darken-1">
                            <i class="fa fa-edit"></i> Modificados
                            <div style="margin-top: 5px;" class="chip right blue lighten-2">
                                <strong>Venta: {{tmlstM[1] | number:"2"}}</strong></div>
                            <div style="margin-top: 5px;" class="chip right blue lighten-2">
                                <strong>Compra: {{tmlstM[0] | number:"2"}}</strong></div>
                        </div>
                        <div class="collapsible-body" ng-style="mmview ? {display: 'block'} : {display: 'none'}">
                            <table class="table responsive-table highlight hovered">
                                <thead>
                                    <tr class="blue lighten-5">
                                        <th class="col-1 center-align"><a href="#!" class="grey-text text-darken-3"><i class="fa fa-filter"></i></a></th>
                                        <th>Código</th>
                                        <th>Descripción</th>
                                        <th>Marca</th>
                                        <th>Modelo</th>
                                        <th class="col-2">Unidad</th>
                                        <th class="right-align col-2">P.Compra</th>
                                        <th class="right-align col-2">P.Ventas</th>
                                        <th class="right-align col-2">Pendiente</th>
                                        <th class="right-align col-2">Cantidad</th>
                                        <th class="col-1">
                                            <a href="#!reload" class="col-1 blue-text" ng-click="listTemps('M')">
                                                <i class="fa fa-refresh"></i>
                                            </a>
                                        </th>
                                        <th class="col-1">
                                            <a href="#!del" class="red-text col-1" ng-click="delModifiedNMD('M')">
                                                <i class="fa fa-trash"></i>
                                            </a>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="x in lstM">
                                        <td>{{$index+1}}</td>
                                        <td>{{x.fields.materials.pk}}</td>
                                        <td>{{x.fields.materials.fields.matnom}} {{x.fields.materials.fields.matmed}}</td>
                                        <td>{{x.fields.brand.fields.brand}}</td>
                                        <td>{{x.fields.model.fields.model}}</td>
                                        <td>{{x.fields.materials.fields.unidad}}</td>
                                        <td>{{x.fields.ppurchase}}</td>
                                        <td>{{x.fields.psales}}</td>
                                        <td>{{x.fields.missingsend}}</td>
                                        <td>{{x.fields.quantity}}</td>
                                        <td>
                                            <i class="fa" ng-class="{'fa-long-arrow-up': x.fields.symbol == '+','fa-long-arrow-down': x.fields.symbol == '-'}"></i>
                                        </td>
                                        <td>
                                            <input type="checkbox" class="filled-in red" id="filled-in-boxlstm{{$index}}" ng-model="lstM[$index].selected" ng-init="lstM[$index].selected=false" />
                                            <label for="filled-in-boxlstm{{$index}}"></label>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </li>
                    <li ng-class="{'active': mmview}">
                        <div ng-class="{'active': mmview}" class="collapsible-header red-text">
                            <i class="fa fa-trash"></i> Eliminados
                            <div style="margin-top: 5px;" class="chip right red lighten-2">
                                <strong>Venta: {{tmlstD[1] | number:"2"}}</strong></div>
                            <div style="margin-top: 5px;" class="chip right red lighten-2">
                                <strong>Compra: {{tmlstD[0] | number:"2"}}</strong></div>
                        </div>
                        <div class="collapsible-body" ng-style="mmview ? {display: 'block'} : {display: 'none'}">
                            <table class="table responsive-table highlight hovered">
                                <thead>
                                    <tr class="red lighten-5">
                                        <th><a href="#!" class="grey-text text-darken-3"><i class="fa fa-filter"></i></a></th>
                                        <th>Código</th>
                                        <th>Descripción</th>
                                        <th>Marca</th>
                                        <th>Modelo</th>
                                        <th>Unidad</th>
                                        <th class="right-align">P. Compra</th>
                                        <th class="right-align">P. Ventas</th>
                                        <th class="right-align">En Pedidos</th>
                                        <th class="right-align">C. Eliminar</th>
                                        <th>
                                            <a href="#!lnew" class="blue-text" ng-click="listTemps('D')">
                                                <i class="fa fa-refresh"></i>
                                            </a>
                                        </th>
                                        <th>
                                            <a href="#!del" class="red-text" ng-click="delModifiedNMD('D')">
                                                <i class="fa fa-trash"></i>
                                            </a>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="x in lstD">
                                        <td>{{$index+1}}</td>
                                        <td class="center-align">{{x.fields.materials.pk}}</td>
                                        <td class="left-align">{{x.fields.materials.fields.matnom}} {{x.fields.materials.fields.matmed}}</td>
                                        <td class="center-align">{{x.fields.brand.fields.brand}}</td>
                                        <td class="center-align">{{x.fields.model.fields.model}}</td>
                                        <td class="center-align">{{x.fields.materials.fields.unidad}}</td>
                                        <td class="right-align">{{x.fields.ppurchase}}</td>
                                        <td class="right-align">{{x.fields.psales}}</td>
                                        <td class="right-align">{{x.fields.missingsend}}</td>
                                        <td class="right-align">{{x.fields.quantity}}</td>
                                        <td class="center-align"><i class="fa fa-long-arrow-down"></i></td>
                                        <td class="center-align">
                                            <input type="checkbox" class="filled-in red" id="filled-in-boxlstd{{$index}}" ng-model="lstD[$index].selected" ng-init="lstD[$index].selected=false" />
                                            <label for="filled-in-boxlstd{{$index}}"></label>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </li>
                </ul>
                {% endverbatim %}
            </div>
            <!-- list current materials -->
            <div id="vlist" class="col l12 m12 s12">
                <table class="bordered responsive-table" ng-show="perarea == 'administrator' || perarea == 'ventas'">
                    <thead>
                        <tr>
                            <th style="max-width: 50px;">{{ dsector.sgroup.project.currency.moneda }}</th>
                            <th class="center-align" colspan="3">SECTOR</th>
                            <th class="center-align" colspan="3">AREA</th>
                        </tr>
                    </thead>
                    {% verbatim %}
                        <tbody>
                            <tr>
                                <th></th>
                                <th class="center-align">VENTA</th>
                                <th class="center-align">SECTOR</th>
                                <th class="center-align">DIFERENCIA</th>
                                <th class="center-align">ACTUAL</th>
                                <th class="center-align">MODIFICADO</th>
                                <th class="center-align">DIFERENCIA</th>
                            </tr>
                            <tr>
                                <th>COMPRA</th>
                                <td class="center-align">{{amsecp|number:"2"}}</td>
                                <td class="center-align">{{((amstp-amnp)+ammp)|number:"2"}}</td>
                                <td class="center-align">{{(amsecp-((amstp-amnp)+ammp))|number:"2"}}</td>
                                <td class="center-align">{{amnp|number:"2"}}</td>
                                <td class="center-align">{{ammp|number:"2"}}</td>
                                <td class="center-align">{{amnp-ammp|number:"2"}}</td>
                            </tr>
                            <tr>
                                <th>VENTA</th>
                                <td class="center-align">{{amsecs|number:"2"}}</td>
                                <td class="center-align">{{((amsts-amns)+amms)|number:"2"}}</td>
                                <td class="center-align">{{(amsecs-((amsts-amns)+amms))|number:"2"}}</td>
                                <td class="center-align">{{amns|number:"2"}}</td>
                                <td class="center-align">{{amms|number:"2"}}</td>
                                <td class="center-align">{{amns-amms|number:"2"}}</td>
                            </tr>
                            <!--<tr>
                                <th>COMPRA</th>
                                <th>
                                    <th>{{amnp|number:"2"}}</th>
                                    <th>{{amnp|number:"2"}}</th>
                                    <th>{{amnp|number:"2"}}</th>
                                </th>
                                <td class="center-align"></td>
                                <th class="center-align">{{amnp|number:"2"}}</th>
                                <th class="center-align">{{ammp|number:"2"}}</th>
                                <th></th>
                            </tr>
                            <tr>
                                <th>VENTA</th>
                                <th>
                                    <th>{{amnp|number:"2"}}</th>
                                    <th>{{amnp|number:"2"}}</th>
                                    <th>{{amnp|number:"2"}}</th>
                                </th>
                                <td class="center-align"></td>
                                <td class="center-align">{{amns|number:"2"}}</td>
                                <td class="center-align">{{amms|number:"2"}}</td>
                                <td></td>
                            </tr>-->
                        </tbody>
                    {% endverbatim %}
                </table>
                <input type="hidden" ng-model="modify" ng-init="modify={{ modify|length }}">
                <input type="hidden" name="pro" value="{{dsector.dsector_id | slice:"0:7"}}">
                <input type="hidden" name="lds" value="true">
                {% verbatim %}
                    <script type="text/ng-template" id="modifytmp.html">

                    </script>
                {% endverbatim %}
                <table class="table highlight responsive-table floatThead">
                    <caption ng-show="fme">
                        <div class="input-field">
                            <i class="prefix fa fa-filter"></i>
                            <input type="text" ng-model="finme">
                            <label>Buscar material</label>
                        </div>
                    </caption>
                    <thead class="amber lighten-4">
                        <tr>
                            <th class="center-align col-1">
                                <i class="fa fa-angle-double-up cursor-hand" onClick="$('html, body').animate({scrollTop: 500}, 400);"></i>
                            </th>
                            <th class="col-1">
                                <div class="switch">
                                    <label>
                                    <!--Off-->
                                    <input type="checkbox" ng-model="schkm" ng-init="schkm=false" ng-checked="schkm" ng-click="schkallmodify()">
                                    <span class="lever red"></span>
                                    <!--On-->
                                    </label>
                                </div>
                            </th>
                            <th class="center-align col-3">Código</th>
                            <th>Descripción</th>
                            <th class="center-align col-2">Marca</th>
                            <th class="center-align col-2">Modelo</th>
                            <th class="center-align col-2">Unidad</th>
                            <th class="right-align col-2">Pendiente</th>
                            <th class="right-align col-2">Vendido</th>
                            <th class="right-align col-2" ng-show="perarea == 'administrator' || perarea == 'ventas'">Compra</th>
                            <th class="right-align col-2" ng-show="perarea == 'administrator' || perarea == 'ventas'">Venta</th>
                            <th class="right-align col-2" ng-show="perarea == 'administrator' || perarea == 'ventas'">Importe</th>
                            <th class="center-align">
                                <i class="fa fa-search cursor-hand" ng-model="fme" ng-click="fme=!fme"></i>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                    {% verbatim %}
                        <tr ng-repeat="x in lmodify | filter: finme" class="text-12">
                            <td class="center-align">{{$index + 1}}</td>
                            <td class="center-align">
                                <input type="checkbox" id="chkmd{{x.pk}}" class="filled-in red" ng-model="mchks[x.pk].status" ng-init="mchks[x.pk].status=false" ng-checked="mchks[x.pk].status">
                                <label for="chkmd{{x.pk}}"></label>
                                <input type="hidden" ng-model="mchks[x.pk].materials" ng-init="mchks[x.pk].materials=x">
                            </td>
                            <td class="center-align text-9">{{x.fields.materials.pk}}</td>
                            <td>{{x.fields.materials.fields.matnom}} {{x.fields.materials.fields.matmed}}</td>
                            <td class="center-align">{{x.fields.brand.fields.brand}}</td>
                            <td class="center-align">{{x.fields.model.fields.model}}</td>
                            <td class="center-align">{{x.fields.materials.fields.unidad}}</td>
                            <td class="right-align col-2">{{x.fields.qorder}}</td>
                            <td class="right-align col-2">{{x.fields.quantity}}</td>
                            <td class="right-align col-2" ng-show="perarea == 'administrator' || perarea == 'ventas'">{{x.fields.ppurchase}}</td>
                            <td class="right-align col-2" ng-show="perarea == 'administrator' || perarea == 'ventas'">{{x.fields.psales}}</td>
                            <td class="right-align col-2" ng-show="perarea == 'administrator' || perarea == 'ventas'">{{x.fields.quantity * x.fields.ppurchase | number:2}}</td>
                            <td class="center-align">
                                <input type="radio" name="wrench" class="with-gap" id="rb{{$index}}" ng-click="enableModify($index, x)">
                                <label for="rb{{$index}}"></label>
                            </td>
                        </tr>
                    {% endverbatim %}
                    </tbody>
                </table>
                <br>
                <br>
                <div class="fixed-action-btn horizontal">
                    <a class="btn-floating btn-large red">
                        <i class="fa fa-wrench"></i>
                    </a>
                    <ul>
                        <li><a href="#chksdel" class="waves-effect btn-floating red tooltipped" ng-click="checkedDelete()" data-position="top" data-delay="50" data-tooltip="eliminar por selección">
                            <i class="fa fa-trash"></i>
                            </a></li>
                        <li ng-show="meditindex!=-1"><a class="waves-effect btn-floating  red" ng-click="enableDel()"><i class="fa fa-minus-circle"></i></a></li>
                        <li ng-show="meditindex!=-1"><a class="waves-effect btn-floating  blue" ng-click="showEdit()"><i class="fa fa-pencil"></i></a></li>
                        <li ng-show="meditindex!=-1"><a class="waves-effect btn-floating  grey darken-1" ng-click="disableModify()"><i class="fa fa-times"></i></a></li>
                    </ul>
                </div>
            </div>
            <!-- view prices -->
            <div id="vprices" class="col l12 m12 s12">
                <h4>Precios</h4>
                <button type="button" ng-show="perarea == 'administrator' || perarea == 'ventas'" class="waves-effect waves-light btn amber grey-text text-darken-3" ng-click="calcApproved()">
                    <i class="fa fa-cog"></i>
                    <span class="hide-on-small-only">Validar Aprobación</span>
                </button>
                {% verbatim %}
                <div class="card-panel center-align" >
                    <div ng-show="perarea == 'administrator' || perarea == 'ventas'">
                        <table class="highlight hover table bordered">
                            <thead>
                                <tr>
                                    <th></th>
                                    <th width="200px">COMPRAS</th>
                                    <th width="200px">VENTAS</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th width="150px">VENTA</th>
                                    <th width="200px">{{amsecp|number:"2"}}</th>
                                    <th width="200px">{{amsecs|number:"2"}}</th>
                                </tr>
                                <tr>
                                    <th width="150px">SECTOR</th>
                                    <th>{{amstp|number:"2"}}</th>
                                    <th>{{amsts|number:"2"}}</th>
                                </tr>
                                <tr class="amber lighten-5">
                                    <th width="150px">PRECIO AREA</th>
                                    <th>{{amnp|number:"2"}}</th>
                                    <th>{{amns|number:"2"}}</th>
                                </tr>
                                <tr class="green lighten-5">
                                    <th width="150px">AGREGAR (+)</th>
                                    <th>{{tmlstN[0]|number:"2"}}</th>
                                    <th>{{tmlstN[1]|number:"2"}}</th>
                                </tr>
                                <tr class="green lighten-5">
                                    <th width="150px" rowspan="2">MODIFICAR (±)</th>
                                    <th>+ {{sldm[0][0]|number:"2"}}</th>
                                    <th>+ {{sldm[1][0]|number:"2"}}</th>
                                </tr>
                                <tr class="red lighten-5">
                                    <th>- {{sldm[0][1]|number:"2"}}</th>
                                    <th>- {{sldm[1][1]|number:"2"}}</th>
                                </tr>
                                <tr class="red lighten-5">
                                    <th width="150px">ELIMINAR (-)</th>
                                    <th>{{tmlstD[0]|number:"2"}}</th>
                                    <th>{{tmlstD[1]|number:"2"}}</th>
                                </tr>
                                <tr class="red lighten-5">
                                    <th width="150px">PRECIO FINAL</th>
                                    <th>{{pnp|number:"2"}}</th>
                                    <th>{{pns|number:"2"}}</th>
                                </tr>
                                <tr class="red lighten-5">
                                    <th width="150px">DIFERENCIA</th>
                                    <th>{{pgpa|number:"2"}}</th>
                                    <th>{{pgsa|number:"2"}}</th>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                {% endverbatim %}
            </div>
        {% endif %}
    </div>
    <!-- utils -->
    <select id="typenip" class="hide">
        {% verbatim %}
            <option ng-repeat="(k, v) in tnipple" value="{{k}}">{{v}}</option>
        {% endverbatim %}
    </select>
    <!-- modal  -->
    <div class="modal" id="mpcopy">
        <div class="modal-content">
            <h4>Copiar Lista de Proyectos</h4>
            <ul class="collection with-header" ng-model="fpl" ng-hide="fpl">
                <li class="collection-header">
                    <div class="input-field">
                        <i class="prefix fa fa-filter"></i>
                        <input type="text" ng-model="ccpf">
                        <label>Buscar</label>
                    </div>
                </li>
            {% verbatim %}
                <li class="collection-item" ng-repeat="x in ascprojects | filter: ccpf |orderBy:'-pk'" data-value="{{x.pk}}">
                    <div>
                        {{x.pk}} - {{x.fields.nompro}}
                        <a href="#" class="secondary-content" ng-click="getsector(x.pk)">
                            <i class="fa fa-chevron-right"></i>
                        </a>
                    </div>
                </li>
            {% endverbatim %}
            </ul>
            <button type="button" class="btn waves-effect grey lighten-4 grey-text text-darken-3" ng-show="fsl" ng-click="fsl=false;fpl=false">
                <i class="fa fa-chevron-left"></i>
                <span>regresar</span>
            </button>
            <ul class="collection with-header" ng-model="fsl" ng-show="fsl">
                <li class="collection-header">
                    <div class="input-field">
                        <i class="prefix fa fa-filter"></i>
                        <input type="text" ng-model="ccsf">
                        <label>Buscar</label>
                    </div>
                </li>
            {% verbatim %}
                <li class="collection-item" ng-repeat="x in ascsector | filter: ccsf |orderBy:'-pk'" data-value="{{x.pk}}">
                    <div>
                        {{x.sector_id}} - {{x.nomsec}}
                        <a href="#" class="secondary-content" ng-click="ccopyps(x.sector_id)">
                            <i class="fa fa-clone"></i>
                        </a>
                    </div>
                </li>
            {% endverbatim %}
            </ul>
        </div>
    </div>
    <div class="modal" id="mfileup">
        <div class="modal-content">
            <h4>Cargar Archivo</h4>
            <div class="file-field input-field">
                <div class="btn red darken-1">
                    <span>Archivo</span>
                    <input type="file" accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel">
                </div>
                <div class="file-path-wrapper">
                    <input type="text" class="file-path validate">
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn grey lighten-4 grey-text text-darken-3 left modal-action modal-close">
                <i class="fa fa-times"></i>
                Cancelar
            </button>
            <button type="button" class="btn red darken-1">
                <i class="fa fa-upload"></i>
                Cargar
            </button>
        </div>
    </div>
    <div class="modal" id="commentm">
        <div class="modal-content">
            {% verbatim %}
            <h5>{{lblmcomment}}</h5>
            <div class="input-field col s12">
                <textarea id="observationmat" class="materialize-textarea" ng-model="mmc">{{mmc}}</textarea>
                <label ng-class="{'active': mmc}" for="observationmat">Observación</label>
            </div>
            {% endverbatim %}
        </div>
        <div class="modal-footer">
            <button type="button" class="btn grey lighten-4 grey-text text-darken-3 left modal-action modal-close">
                <i class="fa fa-times"></i>
                Cancelar
            </button>
            <button type="button" id="mcs" class="btn green lighten-1 grey-text text-darken-3" ng-click="saveComment($event)">
                <i class="fa fa-floppy-o"></i>
                GUARDAR
            </button>
        </div>
    </div>
    <div class="row">
        <div class="modal bottom-sheet" style="max-height: 96%;" id="morders">
            <div class="modal-content" ng-model="ordersp1" ng-hide="ordersp1">
                <h5>
                    Pedido Almacén
                    <br>
                    <small>
                        <button type="button" class="btn grey lighten-5 grey-text text-darken-3 modal-action modal-close">
                            <i class="fa fa-times"></i>
                            SALIR
                        </button>
                        <button type="button" class="right btn light-blue darken-1" ng-click="nextStepOrder()">
                            <i class="fa fa-arrow-right"></i>
                            continuar
                        </button>
                    </small>
                </h5>
                <table id="torders" class="table highlight responsive-table">
                    <thead>
                        <tr class="brown lighten-4">
                            <th class="center-align"></th>
                            <th class="center-align">Código</th>
                            <th class="center-align">Descripción</th>
                            <th class="center-align">Marca</th>
                            <th class="center-align">Modelo</th>
                            <th class="center-align">Cantidad</th>
                            <th class="center-align">C. a Pedir</th>
                            <th class="center-align"></th>
                            <th></th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% verbatim %}
                            <tr ng-repeat="x in preorders | filter: {tag:'!2'} | filter: {'status': true}">
                                <td>{{$index + 1 }}</td>
                                <td>{{x.materials.pk}}</td>
                                <td>{{x.materials.fields.matnom}} {{x.materials.fields.matmed}}</td>
                                <td>{{x.brand.fields.brand}}</td>
                                <td>{{x.model.fields.model}}</td>
                                <td class="center-align">{{x.quantity}}</td>
                                <td>
                                    <input type="number" step="0.01" min="0" ng-model="preorders[x.index].qorder" ng-init="preorders[x.index].qorder=(x.niple)?0:x.quantity" max="{{x.quantity}}" min="0" class="right-align" ng-readonly="x.niple" minandmax>
                                </td>
                                <td class="center-align">
                                    <a class="green-text col-1 waves-effect" ng-if="x.niple==true" ng-click="getNippleMaterials(x.index)">
                                        <i class="fa fa-plus"></i>
                                    </a>
                                </td>
                                <td  class="center-align">
                                    <a class="col-1 waves-effect grey-text text-darken-3" ng-click="addobservation(x.index)">
                                        <i class="fa fa-commenting"></i>
                                    </a>
                                </td>
                                <td  class="center-align">
                                    <a ng-click="deleteItemOrders(x.index)" class="red-text col-1 waves-effect">
                                        <i class="fa fa-times"></i>
                                    </a>
                                </td>
                            </tr>
                        {% endverbatim %}
                    </tbody>
                </table>
                {#% verbatim %#}
                    {% comment %}<table class="table responsive-table highlight" id="ordersnipples" ng-repeat="x in dataOrders" ng-if="x.nipple=='true'" >
                        <thead>
                            <tr>
                                <th style="width: 25px;">
                                    <a href="#!" class="grey lighten-5 grey-text text-darken-3" ng-model="snip[x.id]" ng-init="snip[x.id]=false" ng-click="snip[x.id]=!snip[x.id]">
                                        <i class="fa " ng-class="{'fa-chevron-up': snip[x.id], 'fa-chevron-down': !snip[x.id]}"></i>
                                    </a>
                                </th>
                                <th colspan="5">
                                    {{x.name}}
                                    <div class="switch" ng-show="snip[x.id]">
                                        <input type="hidden" ng-model="radioO[x.id]" ng-init="radioO[x.id]=false">
                                        <label>
                                          Ninguno
                                          <input type="checkbox" value="{{x.id}}" ng-click="sumNipple($event);radioO[x.id]=!radioO[x.id]">
                                          <span class="lever"></span>
                                          Todo
                                        </label>
                                    </div>
                                </th>
                            </tr>
                            <tr ng-show="snip[x.id]">
                                <th class="center-align"></th>
                                <th></th>
                                <th class="center-align">Pedido</th>
                                <th class="center-align">Cantidad</th>
                                <th class="center-align">Tipo</th>
                                <th class="center-align">Diametro</th>
                                <th></th>
                                <th class="center-align">Medida</th>
                                <th class="center-align"></th>
                            </tr>
                        </thead>
                        <tbody ng-model="nip[x.id]" ng-init="nip[x.id]=[]" ng-show="snip[x.id]">
                            <tr ng-repeat="n in nip[x.id]">
                                <td class="center-align">{{$index+1}}</td>
                                <td class="center-align">
                                    <input type="checkbox" name="selno{{x.id}}" id="sel{{n.pk}}" data-nid="{{n.pk}}" value="{{x.id}}" ng-checked="radioO[x.id]" ng-click="sumNipple($event)">
                                    <label for="sel{{n.pk}}"></label>
                                </td>
                                <td class="center-align">
                                    <input type="number" step="0.1" max="{{n.fields.cantshop}}" min="0" class="right-align" id="n{{n.pk}}" data-materials="{{x.id}}" data-qmax="{{n.fields.cantshop}}" value="{{n.fields.cantshop}}" data-measure="{{n.fields.metrado}}" ng-blur="changeQOrders($event)">
                                </td>
                                <td class="center-align">{{n.fields.cantidad}}</td>
                                <td class="center-align">Niple{{n.fields.cantshop > 1 ? 's':''}} {{n.fields.tipo}}</td>
                                <td class="center-align">{{x.name.split('-').slice(-1)[0]}}</td>
                                <td class="center-align">x</td>
                                <td class="center-align">{{n.fields.metrado}}</td>
                                <td class="center-align">cm</td>
                            </tr>
                        </tbody>
                    </table>{% endcomment %}
                {#% endverbatim %#}
            </div>
            <div class="modal-content" ng-model="ordersp2" ng-show="ordersp2">
                <h5>
                    Pedido Almacén
                    <br>
                    <small>
                        <button type="button" class="btn light-blue darken-1" ng-click="ordersp1=false;ordersp2=false">
                            <i class="fa fa-arrow-left"></i>
                            Volver
                        </button>
                        <button type="button" class="right btn light-blue darken-1" ng-click="saveOrdersStorage($event)">
                            <i class="fa fa-floppy-o"></i>
                            GENERAR PEDIDO
                        </button>
                    </small>
                </h5>
                <div class="row">
                    <div class="input-field col l4">
                        <label ng-class="{'active':orders.storage}">Almacén</label>
                        <select class="browser-default" ng-model="orders.storage" ng-init="orders.storage='AL01'" tabindex="0">
                            <option value="" disabled selected>Elije un Almacén</option>
                            {% for a in storage %}
                                <option value="{{a.almacen_id}}">{{a.nombre}}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="input-field col l8">
                        <input type="text" id="issue" ng-model="orders.issue" tabindex="1">
                        <label for="issue">Asunto</label>
                    </div>
                    <!--<div class="input-field col l2">
                        <input type="text" disabled="true" value="{{request.user.get_profile.empdni_id}}">
                    </div>-->
                    <div class="input-field col l8">
                        <input type="text" disabled="true" value="{{request.user.get_profile.empdni_id}} {{request.user.get_profile.empdni.name_complete}}">
                        <label for="name">Responsable</label>
                    </div>
                    <div class="input-field col l2">
                        <input type="text" id="transfer" class="validate datepicker" ng-model="orders.transfer" tabindex="2">
                        <label for="transfer">Traslado</label>
                    </div>
                    <div class="file-field input-field col l12">
                        <div class="btn">
                            <span>Archivo</span>
                            <input type="file" ng-model="orders.files" id="ordersfiles" tabindex="4">
                        </div>
                        <div class="file-path-wrapper">
                            <input class="file-path validate" type="text">
                        </div>
                    </div>
                    <div class="input-field col s12">
                        <textarea id="observation" ng-model="orders.observation" ng-init="orders.observation=''" class="materialize-textarea" length="246" tabindex="3"></textarea>
                        <label for="observation">Observaciones</label>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% verbatim %}
    <!-- modal for set observation for each item-->
    <div id="mobservation" class="modal modal-fixed-footer">
        <div class="modal-content">
            <h6>{{sitem.materials.fields.matnom}} {{sitem.materials.fields.matmed}}</h6>
            <div id="editor"></div>
        </div>
        <div class="modal-footer">
            <button type="button" class="waves-effect btn blue" ng-click="saveobservation()">
                <i class="fa fa-floppy-o "></i>
                <span>GUARDAR</span>
            </button>
            <button type="button" class="modal-action modal-close waves-effect btn grey lighten-5 grey-text text-darken-3">
                <i class="fa fa-times "></i>
                <span>SALIR</span>
            </button>
        </div>
    </div>
    <!-- show modal for seleccion niple -->
    <div id="mselectedniple" class="modal modal-fixed-footer">
        <div class="modal-content">
            <h5>
                <small>NIPLES {{selectedniple.materials.fields.matnom}} {{selectedniple.materials.fields.matmed}} {{selectedniple.materials.fields.unidad}}  </small>
            </h5>
            <table class="table hovered highlight responsive-table">
                <thead>
                    <tr class="lime lighten-3">
                        <th></th>
                        <th></th>
                        <th>Descripción</th>
                        <th>Tipo</th>
                        <th></th>
                        <th>Medida</th>
                        <th>Cantidad</th>
                        <th class="col-3">C. a Pedir</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="x in selectedniple.details ">
                        <td class="center-align">{{$index+1}}</td>
                        <td>
                            <input type="checkbox" id="sn{{x.pk}}" class="filled-in amber" ng-model="selectedniple.details[$index].status" ng-init="selectedniple.details[$index].status=false">
                            <label for="sn{{x.pk}}"></label>
                        </td>
                        <td class="left-align">Niple {{tnipple[x.fields.tipo]}}</td>
                        <td>{{x.fields.tipo}}</td>
                        <td>x</td>
                        <td>{{x.fields.metrado}} cm</td>
                        <td>{{x.fields.cantshop}}</td>
                        <td>
                            <input type="number" step="0.01" min="0" max="{{x.fields.cantshop}}" ng-model="selectedniple.details[$index].qorder" ng-init="selectedniple.details[$index].qorder=x.fields.cantshop" ng-disabled="!selectedniple.details[$index].status" minandmax>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="modal-footer">
            <button type="button" class="waves-effect btn red" ng-click="sumSelectedNiple()">
                <i class="fa fa-check"></i>
                <span>ACEPTAR</span>
            </button>
            <button type="button" class="modal-action modal-close waves-effect btn grey lighten-5 grey-text text-darken-3" ng-click="sumSelectedNiple()">
                <i class="fa fa-external-link"></i>
                <span>DEJAR EN CERO</span>
            </button>
            <p>
                <input type="radio" id="rdosn1" name="rdosn" ng-click="selectedmodalniples($event)" value="1" class="with-gap amber">
                <label for="rdosn1">Todo</label>
                <input type="radio" id="rdosn2" name="rdosn" ng-click="selectedmodalniples($event)" value="0" class="amber">
                <label for="rdosn2">Ninguno</label>
            </p>
        </div>
    </div>
    {% endverbatim %}
    <div class="modal" id="mdplane">
        <div class="modal-content">
            <div class="file-field input-field">
                <div class="btn">
                    <span>Seleccionar</span>
                    <input type="file" file="file" accept="application/pdf">
                </div>
                <div class="file-path-wrapper">
                    <input class="file-path validate" type="text">
                </div>
            </div>
            <div class="input-field">
                <textarea id="textarea1" class="materialize-textarea" ng-model="note"></textarea>
                <label for="textarea1">Nota</label>
            </div>
        </div>
        <div class="modal-footer">
            <button type="buttom" class="btn waves waves-effect light-blue accent-4 grey-text text-lighten-5" ng-click="uploadPlane()">
                <i class="fa fa-upload"></i>
                Cargar Plano
            </button>
            <button type="buttom" class="modal-action modal-close btn waves waves-effect grey lighten-5 grey-text text-darken-3">
                <i class="fa fa-times"></i>
                Cancelar
            </button>
        </div>
    </div>
    {% verbatim %}
    <div id="sPlane" class="modal bottom-sheet" style="min-height: 100%;">
        <button type="button" class="modal-action modal-close waves-effect waves-orange btn btn-flat right">
            <i class="fa fa-times"></i>
        </button>
        <div class="modal-content">
            <iframe id"sfplane" type="application/pdf" style="height: 96%; width: 97%; position: absolute;" src=""></iframe>
        </div>
    </div>
    <!-- modal update 2016-11-28 11:49:36-->
    <div class="modal" id="msedit">
        <div class="modal-content">
            <h5>
                {{objedit.fields.materials.fields.matnom}} {{objedit.fields.materials.fields.matmed}}
                <br>
                <small>{{objedit.fields.materials.pk}} / {{objedit.fields.materials.fields.unidad}}</small>
            </h5>
            <div class="row">
                <div class="col l6 m6 s12 input-field">
                    <select id="edbrand" ng-model="editm['brand']" ng-options="x.pk as x.fields.brand for x in lbrand">
                        <option value="" disabled>--Seleccione-</option>
                    </select>
                    <label for="edbrand">Marca</label>
                </div>
                <div class="col l6 m6 s12 input-field">
                    <select id="edmodel" ng-model="editm['model']" id="" ng-options="x.pk as x.fields.model for x in lmodel">
                        <option value="" disabled>--Seleccione-</option>
                    </select>
                    <label for="edmodel">Modelo</label>
                </div>
                <div class="col l6 m6 s12 input-field">
                    <input type="number" class="right-align" ng-model="editm['quantity']" step="0.01">
                    <label for="">Cantidad</label>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button ng-disabled="status" type="buton" class="left modal-action modal-close waves-effect btn grey lighten-5 grey-text text-darken-3">
                <i class="fa fa-times"></i>
                <span class="hide-on-small-only">Salir</span>
            </button>
            <button ng-disabled="status" type="buton" class="waves-effect btn blue" ng-click="saveModify()">
                <i class="fa" ng-class="{'fa-cog fa-spin fa-fw': status, 'fa-floppy-o': !status}"></i>
                <span class="hide-on-small-only">Guardar</span>
            </button>
        </div>
    </div>
    <div id="mwithout" class="modal modal-fixed-footer" style="width: 90% !important;">
        <div class="modal-content">
            <h4>Materiales sin precio</h4>
            <table class="table hovered highlight responsible-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Descripcón</th>
                        <th>Marca</th>
                        <th>Modelo</th>
                        <th>P.Compra</th>
                        <th>P.Venta</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="x in withoutprices">
                        <td>{{$index+1}}</td>
                        <td>{{x.fields.materials.fields.matnom}} {{x.fields.materials.fields.matmed}}</td>
                        <td>{{x.fields.brand.fields.brand}}</td>
                        <td>{{x.fields.model.fields.model}}</td>
                        <td class="col-3">
                            <input type="hidden" ng-model="wout[$index].materials" ng-init="wout[$index].materials=x.fields.materials.pk">
                            <input type="hidden" ng-model="wout[$index].brand" ng-init="wout[$index].brand=x.fields.brand.pk">
                            <input type="hidden" ng-model="wout[$index].model" ng-init="wout[$index].model=x.fields.model.pk">
                            <input type="number" class="right-align" ng-model="wout[$index].pp" min="0" ng-blur="updatePrice($index)"></td>
                        <td class="col-3">
                            <input type="number" class="right-align" ng-model="wout[$index].pv" min="0" ng-blur="updatePrice($index)"></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="modal-footer">
            <button type="button" class="modal-action modal-close waves-effect btn grey lighten-5 grey-text text-darken-3">
                <i class="fa fa-times"></i>
                <span class="hide-on-small-only">SALIR</span>
            </button>
        </div>
    </div>
    {% endverbatim %}
</div>
{% csrf_token %}
<script type="text/javascript" src="{{ MEDIA_URL }}vendor/angular/angular.min.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}vendor/angular-cookies/angular-cookies.min.js"></script>
<!-- <script type="text/javascript" src="{{ MEDIA_URL }}vendor/angular-sanitize/angular-sanitize.min.js"></script> -->
<script type="text/javascript" src="{{ MEDIA_URL }}vendor/jquery.floatThead/dist/jquery.floatThead.min.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}vendor/mustache.js/mustache.min.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}js/getMaterials.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}js/directives.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}vendor/trumbowyg/dist/trumbowyg.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}js/mailing.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}js/operations/dsector.js"></script>
{% endblock %}